# نظام الطلبات والدفع المحدث

تم تطوير نظام شامل للطلبات والدفع يتضمن صفحة دفع متطورة وصفحة متابعة الطلبات مع حفظ محلي للطلبات.

## المزايا الرئيسية

### 1. معلومات العميل
- **الاسم الكامل** (مطلوب)
- **رقم الهاتف** (مطلوب)
- **البريد الإلكتروني** (اختياري)
- **عنوان التوصيل** (مطلوب)

### 2. طرق الدفع
- **الدفع عند التوصيل** (نقداً)
- **البطاقة الائتمانية/الخصم**
- **الدفع الإلكتروني** (محفظة رقمية)

### 3. التعليمات الخاصة
- حقل نص حر للتعليمات الخاصة
- متطلبات غذائية خاصة
- ملاحظات إضافية للطلب

### 4. ملخص الطلب
- عرض جميع العناصر المحددة
- الكميات والأحجام
- **المجموع الإجمالي** (بدون رسوم إضافية)

### 5. الحفظ المحلي للطلبات
- حفظ تلقائي لرقم الطلب في localStorage
- الحفظ مع الطابع الزمني
- حذف تلقائي للطلبات بعد 24 ساعة
- عرض الطلبات المحفوظة في صفحة الطلبات

### 6. صفحة متابعة الطلبات
- عرض الطلبات المحفوظة محلياً
- البحث عن طلبات برقم الطلب
- عرض تفاصيل الطلب الكاملة
- متابعة حالة الطلب

## التنقل والاستخدام

### للوصول إلى صفحة الدفع:
1. أضف عناصر إلى السلة من أي صفحة في المطعم
2. اضغط على أيقونة السلة لفتح الشريط الجانبي
3. اضغط على زر "Proceed to Checkout"
4. ستنتقل إلى صفحة الدفع المخصصة

### إتمام الطلب:
1. املأ معلومات العميل المطلوبة
2. اختر طريقة الدفع المفضلة
3. أضف أي تعليمات خاصة (اختياري)
4. راجع ملخص الطلب
5. اضغط على "Place Order"

## صفحة تأكيد الطلب

بعد إتمام الطلب بنجاح، سيظهر للعميل:
- **رقم الطلب** الفريد
- تأكيد استلام الطلب
- تقدير وقت التوصيل
- خيارات للمتابعة:
  - العودة للتسوق
  - تتبع الطلب

## الميزات التقنية

### التحقق من البيانات
- التأكد من إدخال المعلومات المطلوبة
- رسائل خطأ واضحة للمستخدم
- التحقق من صحة البريد الإلكتروني

### تجربة المستخدم
- تصميم متجاوب لجميع الأجهزة
- واجهة مستخدم حديثة ومريحة
- تحميل سلس مع مؤشرات التحميل
- رسائل نجاح وخطأ واضحة

### الأمان
- التعامل الآمن مع بيانات العملاء
- تشفير المعلومات الحساسة
- عدم تخزين بيانات الدفع في الفرونت إند

## صفحة متابعة الطلبات (/orders)

### الميزات:
1. **عرض الطلبات المحفوظة:**
   - قائمة بالطلبات المحفوظة محلياً خلال آخر 24 ساعة
   - عرض رقم الطلب، التاريخ، والوقت، والمبلغ الإجمالي
   - إمكانية اختيار طلب من القائمة

2. **البحث اليدوي:**
   - حقل إدخال لرقم الطلب
   - إمكانية البحث عن أي طلب برقمه
   - رسائل خطأ واضحة إذا لم يتم العثور على الطلب

3. **تفاصيل الطلب:**
   - معلومات العميل الكاملة
   - قائمة عناصر الطلب مع الكميات والأسعار
   - التعليمات الخاصة (إن وجدت)
   - حالة الطلب مع رموز ملونة
   - حالة الدفع
   - تاريخ ووقت الطلب

4. **حالات الطلب:**
   - قيد الانتظار (أصفر)
   - قيد التحضير (أزرق)
   - جاهز للتوصيل (أخضر)
   - تم التوصيل (أخضر زمردي)
   - ملغي (أحمر)

### الحفظ المحلي (localStorage):
```json
{
  "user_orders": [
    {
      "id": "order_123456",
      "timestamp": "2024-01-15T10:30:00.000Z",
      "total": 67.50
    }
  ]
}
```

### التنظيف التلقائي:
- يتم حذف الطلبات تلقائياً بعد 24 ساعة من تاريخ الحفظ
- التنظيف يحدث عند:
  - فتح صفحة الطلبات
  - إتمام طلب جديد

## الملفات المحدثة

1. **صفحة الدفع المحدثة:**
   - `src/pages/Checkout.tsx`

2. **صفحة الطلبات الجديدة:**
   - `src/pages/Orders.tsx`

3. **تحديث الشريط الجانبي للسلة:**
   - `src/components/CartSidebar.tsx`

4. **تحديث التوجيه:**
   - `src/App.tsx`

5. **الخدمات المستخدمة:**
   - `src/services/orderService.ts`
   - `src/contexts/CartContext.tsx`

## البيانات المرسلة للخادم

```json
{
  "items": [
    {
      "id": "item_id",
      "name": "اسم العنصر",
      "price": 25.00,
      "quantity": 2
    }
  ],
  "total_amount": 67.50,
  "customer_info": {
    "name": "اسم العميل",
    "phone": "رقم الهاتف",
    "email": "البريد الإلكتروني",
    "address": "عنوان التوصيل"
  },
  "special_instructions": "التعليمات الخاصة",
  "delivery_address": "عنوان التوصيل",
  "payment_method": "cash|card|online"
}
```

## التطوير المستقبلي

### تحسينات مقترحة:
1. **تكامل بوابات الدفع الحقيقية**
2. **تتبع الطلبات في الوقت الفعلي**
3. **حفظ عناوين العملاء المتكررين**
4. **تقدير أكثر دقة لوقت التوصيل**
5. **رموز الخصم والعروض الترويجية**
6. **تأكيد الطلب عبر الرسائل النصية**

---

تم إنشاء صفحة الدفع بنجاح وهي جاهزة للاستخدام مع التطبيق الحالي!
